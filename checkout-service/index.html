<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout Service - Bestellungs√ºbersicht</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 1rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            text-align: center;
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            color: #666;
            font-size: 1.1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #666;
            font-size: 1rem;
        }

        .orders-section {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .section-title {
            font-size: 1.5rem;
            color: #333;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #28a745;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-danger {
            background: #dc3545;
        }

        .orders-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .order-card {
            border: 1px solid #e1e5e9;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .order-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .order-id {
            font-weight: bold;
            color: #333;
            font-size: 1.1rem;
        }

        .order-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .status-processing {
            background: #fff3cd;
            color: #856404;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
        }

        .order-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .detail-item {
            text-align: center;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .detail-label {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 0.25rem;
        }

        .detail-value {
            font-weight: bold;
            color: #333;
        }

        .empty-state {
            text-align: center;
            padding: 4rem;
            color: #666;
        }

        .empty-state h3 {
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .message {
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            font-weight: 500;
        }

        .info {
            background: #cce5ff;
            color: #004085;
            border: 1px solid #b3d9ff;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .kafka-status {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .kafka-status h3 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            color: #333;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .connected {
            background: #28a745;
        }

        .disconnected {
            background: #dc3545;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .controls {
                width: 100%;
                justify-content: stretch;
            }

            .order-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üí≥ Checkout Service</h1>
            <p>Bestellungsverarbeitung & Kafka Message Consumer</p>
        </div>

        <!-- Kafka Status -->
        <div class="kafka-status">
            <h3>üì° Kafka Connection Status</h3>
            <div class="connection-status" id="kafka-status">
                <span class="status-dot disconnected"></span>
                <span>Verbindungsstatus wird gepr√ºft...</span>
            </div>
        </div>

        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üì¶</div>
                <div class="stat-value" id="total-orders">0</div>
                <div class="stat-label">Gesamte Bestellungen</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚è≥</div>
                <div class="stat-value" id="processing-orders">0</div>
                <div class="stat-label">In Bearbeitung</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-value" id="completed-orders">0</div>
                <div class="stat-label">Abgeschlossen</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üí∞</div>
                <div class="stat-value" id="total-amount">0.00‚Ç¨</div>
                <div class="stat-label">Gesamtumsatz</div>
            </div>
        </div>

        <!-- Orders Section -->
        <div class="orders-section">
            <div class="section-header">
                <div class="section-title">
                    üìã Bestellungs√ºbersicht
                    <div class="status-indicator"></div>
                </div>
                <div class="controls">
                    <button onclick="refreshOrders()" class="btn">üîÑ Aktualisieren</button>
                    <button onclick="clearOrders()" class="btn btn-danger">üóëÔ∏è Liste leeren</button>
                    <button onclick="goToShopping()" class="btn btn-secondary">üõí Zum Shop</button>
                </div>
            </div>

            <div id="message"></div>

            <div class="orders-list" id="orders-list">
                <div class="empty-state">
                    <h3>üì≠ Keine Bestellungen</h3>
                    <p>Sobald Kunden √ºber den Shopping Service bestellen, erscheinen die Bestellungen hier.</p>
                    <button onclick="simulateOrder()" class="btn" style="margin-top: 1rem;">
                        üé≠ Test-Bestellung simulieren
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const CHECKOUT_API_BASE = '/api/checkout'; // Hypothetical checkout API
        const SHOPPING_API_BASE = '/api/shopping';
        
        // State
        let orders = [];
        let isConnectedToKafka = false;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeCheckoutService();
            loadStoredOrders();
            updateStats();
            simulateKafkaConnection();
        });

        function initializeCheckoutService() {
            showMessage('‚ÑπÔ∏è Checkout Service Simulation gestartet. Da der echte Service nur Kafka-Messages konsumiert, wird hier eine Simulation angezeigt.', 'info');
        }

        function loadStoredOrders() {
            const storedOrders = localStorage.getItem('checkoutOrders');
            if (storedOrders) {
                orders = JSON.parse(storedOrders);
                displayOrders();
                updateStats();
            }
        }

        function saveOrders() {
            localStorage.setItem('checkoutOrders', JSON.stringify(orders));
        }

        function simulateKafkaConnection() {
            // Simulate Kafka connection status
            setTimeout(() => {
                isConnectedToKafka = true;
                updateKafkaStatus();
                
                // Start listening for simulated messages
                startMessageListener();
            }, 2000);
        }

        function updateKafkaStatus() {
            const statusElement = document.getElementById('kafka-status');
            if (isConnectedToKafka) {
                statusElement.innerHTML = `
                    <span class="status-dot connected"></span>
                    <span>‚úÖ Verbunden mit Kafka Topic "checkout"</span>
                `;
            } else {
                statusElement.innerHTML = `
                    <span class="status-dot disconnected"></span>
                    <span>‚ùå Nicht verbunden</span>
                `;
            }
        }

        function startMessageListener() {
            // Simulate receiving messages from Kafka
            // In real implementation, this would be a WebSocket or Server-Sent Events connection
            console.log('üéß Listening for Kafka messages...');
            
            // Check for new orders every 5 seconds (simulation)
            setInterval(() => {
                checkForNewOrders();
            }, 5000);
        }

        function checkForNewOrders() {
            // This is a simulation - in reality, the Go service would consume Kafka messages
            // and we might expose them via a REST API or WebSocket
            
            const lastOrderTime = localStorage.getItem('lastOrderCheck') || '0';
            const currentTime = Date.now().toString();
            
            // Simulate random new orders occasionally
            if (Math.random() < 0.1) { // 10% chance every 5 seconds
                simulateOrder();
            }
            
            localStorage.setItem('lastOrderCheck', currentTime);
        }

        function simulateOrder() {
            const orderId = `ord-${Date.now()}`;
            const userId = `user-${Math.floor(Math.random() * 1000)}`;
            const productIds = [
                `prod-${Math.floor(Math.random() * 100)}`,
                `prod-${Math.floor(Math.random() * 100)}`
            ];
            const amount = (Math.random() * 200 + 10).toFixed(2);

            const newOrder = {
                order_id: orderId,
                user_id: userId,
                product_ids: productIds,
                amount: parseFloat(amount),
                status: 'processing',
                timestamp: new Date().toISOString(),
                processed_at: new Date().toISOString()
            };

            receiveOrder(newOrder);
        }

        function receiveOrder(orderData) {
            // Simulate receiving an order from Kafka
            console.log('üì¶ Neue Bestellung empfangen:', orderData);
            
            orders.unshift(orderData);
            saveOrders();
            displayOrders();
            updateStats();
            
            showMessage(`üéâ Neue Bestellung empfangen: ${orderData.order_id}`, 'success');
            
            // Simulate processing
            setTimeout(() => {
                processOrder(orderData.order_id);
            }, Math.random() * 10000 + 5000); // 5-15 seconds
        }

        function processOrder(orderId) {
            const order = orders.find(o => o.order_id === orderId);
            if (order && order.status === 'processing') {
                order.status = 'completed';
                order.completed_at = new Date().toISOString();
                saveOrders();
                displayOrders();
                updateStats();
                
                showMessage(`‚úÖ Bestellung ${orderId} erfolgreich verarbeitet!`, 'success');
            }
        }

        function displayOrders() {
            const ordersList = document.getElementById('orders-list');
            
            if (orders.length === 0) {
                ordersList.innerHTML = `
                    <div class="empty-state">
                        <h3>üì≠ Keine Bestellungen</h3>
                        <p>Sobald Kunden √ºber den Shopping Service bestellen, erscheinen die Bestellungen hier.</p>
                        <button onclick="simulateOrder()" class="btn" style="margin-top: 1rem;">
                            üé≠ Test-Bestellung simulieren
                        </button>
                    </div>
                `;
                return;
            }

            ordersList.innerHTML = orders.map(order => `
                <div class="order-card">
                    <div class="order-header">
                        <div class="order-id">üîñ ${order.order_id}</div>
                        <div class="order-status status-${order.status}">
                            ${order.status === 'processing' ? '‚è≥ In Bearbeitung' : '‚úÖ Abgeschlossen'}
                        </div>
                    </div>
                    <div class="order-details">
                        <div class="detail-item">
                            <div class="detail-label">Kunde</div>
                            <div class="detail-value">${order.user_id}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Produkte</div>
                            <div class="detail-value">${order.product_ids.length} Artikel</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Betrag</div>
                            <div class="detail-value">${order.amount.toFixed(2)}‚Ç¨</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Erstellt</div>
                            <div class="detail-value">${new Date(order.timestamp).toLocaleString('de-DE')}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateStats() {
            const totalOrders = orders.length;
            const processingOrders = orders.filter(o => o.status === 'processing').length;
            const completedOrders = orders.filter(o => o.status === 'completed').length;
            const totalAmount = orders.reduce((sum, order) => sum + order.amount, 0);

            document.getElementById('total-orders').textContent = totalOrders;
            document.getElementById('processing-orders').textContent = processingOrders;
            document.getElementById('completed-orders').textContent = completedOrders;
            document.getElementById('total-amount').textContent = `${totalAmount.toFixed(2)}‚Ç¨`;
        }

        function refreshOrders() {
            showMessage('üîÑ Bestellungen aktualisiert', 'info');
            displayOrders();
            updateStats();
        }

        function clearOrders() {
            if (confirm('M√∂chtest du wirklich alle Bestellungen l√∂schen?')) {
                orders = [];
                saveOrders();
                displayOrders();
                updateStats();
                showMessage('üóëÔ∏è Alle Bestellungen gel√∂scht', 'warning');
            }
        }

        function goToShopping() {
            window.open('../shopping-service/index.html', '_blank', 'width=1200,height=800');
        }

        function showMessage(message, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = `<div class="message ${type}">${message}</div>`;
            setTimeout(() => {
                messageDiv.innerHTML = '';
            }, 5000);
        }

        // Simulate real-time updates
        setInterval(() => {
            if (orders.length > 0) {
                updateStats();
            }
        }, 10000);

        // Add some initial demo data
        setTimeout(() => {
            if (orders.length === 0) {
                const demoOrders = [
                    {
                        order_id: 'ord-demo-001',
                        user_id: 'user-demo',
                        product_ids: ['prod-001', 'prod-002'],
                        amount: 49.99,
                        status: 'completed',
                        timestamp: new Date(Date.now() - 3600000).toISOString(),
                        completed_at: new Date(Date.now() - 3000000).toISOString()
                    },
                    {
                        order_id: 'ord-demo-002',
                        user_id: 'user-demo-2',
                        product_ids: ['prod-003'],
                        amount: 29.99,
                        status: 'processing',
                        timestamp: new Date(Date.now() - 1800000).toISOString()
                    }
                ];
                
                orders = demoOrders;
                saveOrders();
                displayOrders();
                updateStats();
            }
        }, 3000);
    </script>
</body>
</html>
